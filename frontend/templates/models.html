<!-- models.html -->
{% extends 'base.html' %}

{% block title %}Models - Predictor{% endblock %}

{% block content %}

<div class="container" id="models_container" style="overflow: hidden">
  <div class="row">
    <div class="col-md-12">
      Total Models Provided:
      <span id="total_model" class="badge badge-success"></span>
    </div>
  </div>
  <br />
  <div class="row">
    <div class="col-md-12">
      <div class="form-group">
        <label for="models_list"><strong>Select model name to view details:</strong></label>
        <select id="models_list" class="selectpicker form-control"></select>
      </div>
      <!--
					<h4>Select model name to view details:</h4>
					<select id="models_list" class="form-control" data-live-search="true"></select> 
					-->
    </div>
  </div>

  <div class="row">
    <div class="col-md-12" id="model_info"></div>
  </div>
</div>

<script type="text/template" id="model_detail_template">
  {{"{{#."|safe }}
    <dl class="row">
    <dt class="col-md-2">Name:</dt><dd class="col-md-9"><i>{{name}}</i></dd>
    <dt class="col-md-2">Prediction Type:</dt><dd class="col-md-9">{{type}}</dd>
    <dt class="col-md-2">End Point:</dt><dd class="col-md-9">{{endPoint}}</dd>
    
    <dt class="col-md-2">Group:</dt><dd class="col-md-9">{{group}}</dd>
    <dt class="col-md-2">Title:</dt><dd class="col-md-9">{{title}}</dd>
    <dt class="col-md-2">Num Training Set:</dt><dd class="col-md-9">{{numTraining}}</dd>
    
    <dt class="col-md-2">Num Testing Set:</dt><dd class="col-md-9">{{numTesting}}</dd>
    <dt class="col-md-2">Validation Approach:</dt><dd class="col-md-9">{{validationApproach}}</dd>
    <dt class="col-md-2">R2:</dt><dd class="col-md-9">{{r2}}</dd>
    
    <dt class="col-md-2">RMSE:</dt><dd class="col-md-9">{{rmse}}</dd>
    <dt class="col-md-2">Balanced Accuracy:</dt><dd class="col-md-9">{{accuracy}}</dd>
     
    <dt class="col-md-2">AUC:</dt><dd class="col-md-9">{{auc}}</dd>
    <dt class="col-md-3 gap">Descriptors:</dt>
  <dd class="col-md-12">{{descriptors}}</dd>
    
    <dt class="col-md-3">Machine Learning Approach:</dt>
  <dd class="col-md-12">{{macLearningApproach}}</dd>
    <dt class="col-md-3 gap">Applicability domain:</dt>
  <dd class="col-md-12">{{applicabilityDomain}}</dd>
    
  <dt class="col-md-3 gap">Reference:</dt>
  <dd class="col-md-12">
    {{ "{{#references}}"|safe }}
    {{ "{{.}}<br/>"|safe }}
    {{ "{{/references}}"|safe }}
  </dd>
  <dt class="col-md-2">Source:</dt><dd class="col-md-9"><a href="{{link}}.zip">{{source}}</a></dd>
  </dl>
  {{ "{{/.}}"|safe }}
</script>
</div>

{% endblock %}

{% block scripts %}
<script>
  $(function () {
    setActiveMenu("navbar_models");
    buildModelsList();

    function buildModelsList() {
      $.ajax({
        url: "route/predict/model/idname",
        type: "GET",
        dataType: "json",
        success: function (data, status, xhr) {
          $("#total_model").html(data.length);
          var options = "";
          data.forEach(function (d) {
            options +=
              '<option value="' + d.id + '">' + d.name + "</option>";
          });
          // console.log(options);
          $("#models_list")
            .append(options)
            .promise()
            .done(function () {
              var $this = $(this);
              showModelDetail($this.find("option:first").val());
              $this.on("change", function (e) {
                var modelId = $(this).val();
                showModelDetail(modelId);
              });
              /*
          $this.selectpicker({liveSearch: true,maxOptions: 1}); 
          $this.on('changed.bs.select', function (e) { 
            var modelId=$(this).val(); 
            showModelDetail(modelId);  
          });*/
            });
        },
        error: function (xhr, status, error) {
          errorHandler(xhr, status, error);
        },
      });
    }

    function showModelDetail(modelId) {
      $.ajax({
        url: "route/predict/model/byid/" + modelId,
        type: "GET",
        dataType: "json",
        success: function (data, status, xhr) {
          if (data.references) {
            var refArr = data.references.split(/\|/);
            data.references = refArr;
          }
          var infoHtml = Mustache.to_html(
            $("#model_detail_template").html(),
            data
          ); //cssjs.html
          $("#model_info").html(infoHtml);
        },
        error: function (xhr, status, error) {
          errorHandler(xhr, status, error);
        },
      });
    }
  });
</script>
{% endblock %}